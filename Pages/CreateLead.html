<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=390, initial-scale=1, maximum-scale=1, user-scalable=no">

  <title>Sales Lead UI</title>
  <!-- Bootstrap CSS -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/5.0.2/css/bootstrap.min.css">

  <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>

  <link rel="stylesheet" href="style.css">

  <!-- <script src="login.js"></script> -->

  <!-- Sidebar Script -->
  <script>
      function toggleSidebar() {
      var sidebar = document.getElementById('sidebar');
      sidebar.classList.toggle('collapsed');
    }
  </script>

  <style>
        #sidebar {
      width: 255px;
      position: fixed;
      top: 0;
      left: -250px;
      height: 100vh;
      background-color: #2c2d2f;
      transition: left 0.3s ease-in-out;
      color: white;
      padding-left: 15px;
    }

    #sidebar.collapsed {
      left: 0;
    }
  </style>


</head>



<!-- The following program is to create a sales lead in LogistixAI from a phone, tablet, or any other device
using the most constants possible for the given application. This will provide versitility, ease of use, and
most importantly availability to anyone who needs to put in a lead for any reason, be it the Home depot API
being down, not to mention that all Remarkable, Vantage, and private jobs will have to be put in manually until 
those branches are more established and there are things like a customer facing portal that we can offer.  -->

<!-- So far, this is just the UI, I need to compare with what I have done at home in Javascript and put it all
together. -->

<!-- Outcomes
1. Customer is created in AI with phone number, email, and address
2. A lead with the appropriate order sourcservicee is created in Logistix, and the appropriate flags applied to these jobs
3. For all HD bath jobs, the link to HD  center should populated via custom API into logistix.
5. 5 Links should appear, 
  1. A link to the customers new sales lead
  2. A link to the HD Service center project, if it is from HD source
  3. A link to the customer profile in Logistix
  4. A link to the address on google maps ;)
  5. A button for phone interfaces that will allow the user to immediately call the customer
*** Things to consider
  > Need to check for customer names, numbers, and addresses perhaps that are already in the system, no duplicates
  > Need a standardized way to start labeling private jobs, and all internals, think about how Logistix has unique
      ID's for every job, reguardless of the source or if they already have one or not. 
  > ....

-->


<body>
  <div id="sidebar">
    <br><br>
    <div class="row justify-content-center">
    <h3 style="padding-left: 55px; font-weight: bolder;">🛠  Tools</h3>
    </div>
    <hr>
    <ul>
      <li><a href="#">New Sales Lead</a></li>
      <br>
      <li><a href="#">Schedule Viewer</a></li>
      <br>
      <li><a href="#">Support Request</a></li>
      <br>
      <li><a href="#">Help / Feedback</a></li>
      <br>
      <li><a href="library.html">Paperwork Templates</a></li>
      <br>
      <li><a href="badge.html">Installer Badges</a></li>
      <br>
    </ul>
    <div class="text-center">
      <button type="submit" id="getBearerButton" style="width: 200px" class="btn btn-warning">Bearer</button>
      <hr>
      <input type="text" id="bearerConfirm" placeholder="Token" style="width: 80%">    </div>
  </div>
  <hr>


  <div class="container">

    <div class="row justify-content-center">

      
      <div class="col-md-8 mt-5">
        <img src="../images/incredible Logo.png" alt="">

        <button type="button" id="sideButton" class="btn btn-warning" onclick="toggleSidebar()">👓</button>

        <hr><br>
        <h3 class="text-center"><strong>New Sales Lead</strong></h3>

        <form>
          <div class="mb-3">
            <label for="email" class="form-label">Customer Name</label>
            <span><input type="text" class="form-control" id="FirstName" placeholder="First Name" ><input type="text" class="form-control" id="LastName" placeholder="Last Name"></span>
          </div>
          <div class="mb-3">
            <label for="password" class="form-label">Phone Number</label>
            <input type="text" class="form-control" id="phone" placeholder="Enter Phone Number">
          </div>
          <div class="mb-3">
            <label for="email" class="form-label">Email</label>
            <input type="email" class="form-control" id="email" placeholder="Enter email" >
          </div>
          <div class="mb-3">
            <label for="email" class="form-label">Customer Address</label>
            <input type="text" class="form-control" id="street" placeholder="Street" >
            <input type="text" class="form-control" id="city" placeholder="City" >
            <input type="text" class="form-control" id="zip" placeholder="Zip" >
          </div>

            <hr>

          <div class="mb-3 text-center group">
            <label class="form-label source">Source : <div>   </div></label>
            <div class="form-check form-check-inline">
              <input class="form-check-input" type="radio" name="role" id="role1" value="Home Depot" checked>
              <label class="form-check-label" for="role1">
                Home Depot
              </label>
            </div>
            <div class="form-check form-check-inline">
              <input class="form-check-input" type="radio" name="role" id="role2" value="Remarkable">
              <label class="form-check-label" for="role2">
                Remarkable
              </label>
            </div>
            <div class="form-check form-check-inline">
              <input class="form-check-input" type="radio" name="role" id="role3" value="Vantage">
              <label class="form-check-label" for="role3">
                Vantage
              </label>
            </div>
            <div class="form-check form-check-inline">
              <input class="form-check-input" type="radio" name="role" id="role4" value="Private / Other">
              <label class="form-check-label" for="role4">
                Private / Other
              </label>
            </div>
          </div>
          <hr>
          <div class="mb-3">

            <p>Please input any optional notes below, including special customer requests, or anything the scheduler might need to know. If you are importing a job from HD SS, please include those notes here</p>
            
            <div class="row justify-content-center mt-5">
              <label for="LeadNumber" class="form-label">Lead Number (Required for HD)</label>
              <input type="text" style="width: 90%;" class="form-control" id="LeadNumber"  placeholder="This Number Will begin with an F">
              <br>

              <label class="form-label">Optional Notes : </label>
                <textarea class="form-control" style="width:90%" rows="5" id="jobnotes" placeholder="Enter your feedback"></textarea>
             
            </div>
            
            <!-- <p>Lorem ipsum dolor sit amet consectetur adipisicing elit. Nemo officiis consectetur odio doloremque eum. Dignissimos esse culpa magnam architecto quis rem. In saepe nemo rem, quibusdam vitae iusto nam eos.</p> -->
          </div>
        
          <hr>
        
          
        </form>

        <div class="text-center" id="buttonsToHide">
          <button id="helpmebutton" class="btn btn-success">Help </button> || 
          <button id="customerButton" style="width: 250px" class="btn btn-info">Create Customer and Lead</button> 
           <!-- <button id="customerAndPOButtons" style="width: 250px" class="btn btn-danger">Do Not Use</button>  -->
        </div>


        <hr>
        <span>Customer URL:</span><input type="text" id="textfield2" placeholder="Customer internal GUID will appear here" style="width: 100%">
        <br>
        <span>HD Service URL:</span><input type="text" id="textfield3" placeholder="HD internal GUID will appear here" style="width: 100%">
        <br>
        <span>Logistix Internal #:</span><input type="text" id="textfield5" placeholder="This is the Etteo Order ID" style="width: 100%">


      </div>

    </div>
    
  </div>

  <!-- ---------------------------------------------------------------------------------------------------------- -->
  <!-- ---------------------------------------------------------------------------------------------------------- -->

  <!-- I am going to temporarily keep all of JS here and once it is working locally,
     then I will move it to a remote file, and eventually behind an API-->

     <script>

         



        var bearerToken;
        var customerGUID;

        const data = {
            "userName": "jakesapi@logistixai.com",
            "password": "B=n!v;(]89hCL5VH"
        }

      function getBearer() {
          axios.post('https://api.logistixai.com/api/users/v1/login', data)
          .then(response => {
        
            console.log("The Bearer token is " );
            console.log("=================================");
            console.log(response.data.access_token);
          //   alert(response.data.access_token);
        
            bearerToken = response.data.access_token;
            document.getElementById('bearerConfirm').value = bearerToken;
            // countdownTimer(3599);
            
          })
          .catch(error => {
            console.error(error);
          });
        }

        
        getBearer();

        //  // JavaScript code for button click event handling
        //   document.getElementById('getBearerButton').addEventListener('click', function() {
        //     console.log('Button 1 clickefdsafdasd');
        //     getBearer();
            
        //     // Populate the text field with the response data
        //     // Add your custom code here for Button 1 click event
        //   });

          document.getElementById('customerButton').addEventListener('click', function() {
            if(bearerToken == null){
              alert("Please Get a Bearer Token");
              return;
              }
              LeadNumber = document.getElementById("LeadNumber").value;
              if(LeadNumber == ""){
                alert("You must enter a Lead number to continue 🍔")
              return;  
            }
            console.log('Button 2 clicked');
            createCustomer();


 
          });

            // JavaScript code for button click event handling
          document.getElementById('helpmebutton').addEventListener('click', function() {
            console.log('Button tester clicked');
            alert("Coming Soon 😢")
            // Maybe go find the code from the original paperwork Submission thingy
            
          });

          // document.getElementById('customerAndPOButton').addEventListener('click', function() {
          //   console.log('Customer lead created -- clicked');
          //   alert("I realllllllly hope this works 🤞 🐸")
          //   createLead();
          //   // Most of this will be constants except the source and the notes
          // });



          // Need to grab the text values and store them in variables

          function createCustomer(){

            var firstName = document.getElementById("FirstName").value;
            var lastName = document.getElementById("LastName").value;
            var full = (firstName + " " + lastName);

            var phone = document.getElementById("phone").value;
            var email = document.getElementById("email").value;

            var street = document.getElementById("street").value;
            var city = document.getElementById("city").value;
            var zip = document.getElementById("zip").value;



            console.log(firstName);


            const token = bearerToken;
            const data2 = {
                "contactTypeId":1,
                "contactFirstName":firstName,
                "contactLastName":lastName,
                "contactBusinessName":full,
                "contactEntityTypeId":1,
                "addresses":
                    [{"addressTypeId":3,
                    "addressType":"PHYSICAL",
                    "addressLine1":street,
                    "addressLine2":null,
                    "addressLine3":null,
                    "addressLine4":null,
                    "addressLine5":null,
                    "city": city,
                    "state":"Georgia",
                    "postalCode": zip,
                    "country":null}
                    ],
                "emails":
                    [{"emailAddress": email,
                    "emailTypeId":2,
                    "emailType": "PERSONAL"}
                    ],
                "phoneNos":
                    [{"phoneNumber": phone,
                    "phoneNumberTypeId":6,
                    "phoneNumberType":"MOBILE",
                    "countryCode":"+1",
                    "smsFl":true}
                    ],
                "websites":[]
            };

            const headers = {
            'Authorization': `Bearer ${token}`
            };

            axios.post('https://api.logistixai.com/api/serviceproviders/v1/b0e1556e-a666-496b-a627-a81cf58a623d/customer', data2, { headers })
            .then(response => {
                console.log('Response:', response.data);
                customerGUID = response.data.result;
                // document.getElementById('textfield2').value = customerGUID;
                var customerLink = "https://portal.logistixai.com/customer/profile/b0e1556e-a666-496b-a627-a81cf58a623d/" + customerGUID;
                console.log(customerLink)
                var HomeDepotLink = "https://homeservices.my.site.com/sp/s/global-search/" + LeadNumber;
                document.getElementById('textfield2').value = customerLink;
                document.getElementById('textfield3').value = HomeDepotLink;
                var divv = document.getElementById("customerButton");
            divv.style.display = "none"

            console.log("Customer Guid is: " + customerGUID)
            getCustomerInfo(customerGUID);

              // return customerGUID;
            })
            .catch(error => {
                console.error('Error:', error);
                document.getElementById('textfield2').value = "An Error Has Occurred, This is an Invalid Request";
                document.getElementById('textfield3').value = "An Error Has Occurred, This is an Invalid Request";
                alert("🦆 Bad API Request, Please check your fields\n and try again, or Contact Jake")
            });


           }   






    // <!--Code to get the customer information generated internally in logistix -->


      function getCustomerInfo(guid){


        const token = bearerToken;

        const headers = {
                'Authorization': `Bearer ${token}`
              };

        var customerAPIURL = "https://api.logistixai.com/api/serviceproviders/v1/b0e1556e-a666-496b-a627-a81cf58a623d/customer/" + guid;

        axios.get(customerAPIURL, { headers })
            .then(response => {
                    console.log('Response:', response.data);
                    var saddressID =  response.data.result.addresses[0].addressId;
                    console.log(saddressID);
                    var sphoneNumberID =  response.data.result.phoneNos[0].phoneId;
                    var semailID =  response.data.result.emails[0].emailId;
                    var sstateID =  11;
                    createLead(guid,saddressID,sphoneNumberID,semailID);

   
                })
                .catch(error => {
                    console.error('Error:', error);

                });


      }




    </script>



     <!-- Now the script to create a lead -->
     <script>

          var LeadNumber = "";
          // Variable for external link



    

            // Remember to link in CustomerGuid into this script tag somehow (or compile it all into one)
            function createLead(customerid,addressid,phonenumberid,emailid){

              // All Variables
            var firstName = document.getElementById("FirstName").value;
            var lastName = document.getElementById("LastName").value;
            var full = (firstName + " " + lastName);

            var phone = document.getElementById("phone").value;
            var email = document.getElementById("email").value;

            var street = document.getElementById("street").value;
            var city = document.getElementById("city").value;
            var zip = document.getElementById("zip").value;

            var jobnotes = document.getElementById("jobnotes").value;
            LeadNumber = document.getElementById("LeadNumber").value;

            const token = bearerToken;

            const headers = {
                  'Authorization': `Bearer ${token}`
                };

            var addressID =  addressid;
            var phoneNumberID =  phonenumberid;
            var emailID =  emailid;
            var stateID =  11;

             


        const data3 = {
          "customerId":customerid,
          "addressId":addressID,
          "phoneNumberId":phoneNumberID,
          "emailId":emailID,
          "stateId":stateID,
          "marketId":928,
          "lineOfBusinessId":[
              {
                "id":"fb71e705-be7e-453f-b30d-1ea0cf2021d0",
                "name":"HD SF&I"
              }
          ],
          "orderSourceId":"cbfaf0e0-93bc-48d0-876a-20cc37476cc0",
          "hasExternalSourceId":true,
          "externalSourceId": LeadNumber,
          "services":[
              {
                "lineOfBusinessId":"fb71e705-be7e-453f-b30d-1ea0cf2021d0",
                "serviceMasterId":"4e7a1137-86c4-428b-9941-47a1550b1c27",
                "lineItems":[
                    {
                      "description":jobnotes,
                      "lineItemId":"b8e6a1ca-2a5b-4bdf-888a-1239163526fc",
                      "locationId":"4925c7ed-9423-4db3-a6ee-d3fee9cb5cd6",
                      "lineItemName":"In Home Consult",
                      "lineItemTime":2
                    }
                ]
              }
          ],
          "lineOfBusinessList":[
              "fb71e705-be7e-453f-b30d-1ea0cf2021d0"
          ],
          "PickUpLocation":{
              "contactTypeId":1,
              "contactFirstName":"Home Depot Leads",
              "originFacilityAliasID":"0001",
              "contactEntityTypeId":1,
              "addresses":[
                {
                    "addressLine1":"5852 Conner Rd",
                    "addressLine2":null,
                    "state":"Georgia",
                    "city":"Flowery Branch",
                    "postalCode":"30542"
                }
              ],
              "emails":[
                {
                    "emailAddress":"jake+test@incredibleinstallations.com",
                    "emailTypeId":1,
                    "emailType":"WORK"
                }
              ],
              "phoneNos":[
                {
                    "phoneNumber":"7705401127",
                    "phoneNumberTypeId":1,
                    "phoneNumberType":"WORK",
                    "countryCode":"+1",
                    "smsFl":true
                }
              ],
              "storeNumber":"0001"
          },
          "emailIds":[
              71467
          ]
        }
                axios.post('https://api.logistixai.com/api/orders/V5', data3, { headers })
                .then(response => {
                        console.log('Response:', response.data);
                        // divv.style.display = "none"
                        document.getElementById('textfield5').value = response.data.result.etteoOrderId;
                        console.log(response.data.result.orderId);
                        var tempforflag = response.data.result.orderId;
                        addFlag(tempforflag);


                    })
                    .catch(error => {
                        console.error('Error:', error);
                        document.getElementById('textfield2').value = "An Error Has Occurred, This is an Invalid Request";
                        document.getElementById('textfield3').value = "An Error Has Occurred, This is an Invalid Request";
                        alert("🦆 Bad API Request, Please check your fields\n and try again, or Contact Jake")
                    });


                // Lets hope this is the last time
                setTimeout(function() {
                    console.log('After 3 seconds');
                    updateExternalLink(LeadNumber);

                  }, 3000);


      }


      function updateExternalLink(lead){

          console.log("fjdlsa;fjkdl;sjafkld" + LeadNumber);

          var externalLink = "https://homeservices.my.site.com/sp/s/global-search/" + lead;

          const token = bearerToken;

          const headers = {
                'Authorization': `Bearer ${token}`
              };

          const data4 = 
          {
            "notes":[
                {
                  "note":""
                },
                {
                  "note":""
                }
            ],
            "imsUrl":externalLink,
            "workOrderCost":[
                {
                  "itemNumber":"",
                  "unitCost":""
                }
            ],
            "activities":[
                {
                  "subject":"",
                  "status":"",
                  "type":" ",
                  "dueDate":"",
                  "crewLeading":""
                }
            ],
            "jobPayments":[
                {
                  "paymentNumber":"",
                  "requestedAmount":"",
                  "paymentDescription":"",
                  "type":"",
                  "status":""
                }
            ]
          }

          const flagdata = 
            [{"flagTypeId":"5b4b8ce2-f4a1-47d1-922e-5a12ff5b3b40"}];
          

          var apiurl = "https://api.logistixai.com/api/orders/v5/" + lead
          var flagurl = "https://api.logistixai.com/api/orders/v1/" + customerGUID +  "/flags";

          // Post to API
          axios.put(apiurl, data4, { headers })
            .then(response => {
                    console.log('Response:', response.data);
                    

                })
                .catch(error => {
                    console.error('Error:', error);

                });
         
}
      function addFlag(orderyup){

        var flagurl = "https://api.logistixai.com/api/orders/v1/" + orderyup +  "/flags";

        const flagdata = 
            [{"flagTypeId":"5b4b8ce2-f4a1-47d1-922e-5a12ff5b3b40"}];

        const token = bearerToken;

        const headers = {
              'Authorization': `Bearer ${token}`
            };


        setTimeout(function() {
                          axios.post(flagurl, flagdata,{ headers })
                          .then(response => {
                            console.log('Response:', response.data);
                            console.log("YOU DID IT!!!!")

                            })
                            .catch(error => {
                                console.error('Error:', error);

                            });

                  }, 2000);
}





     </script>
  <!-- ---------------------------------------------------------------------------------------------------------- -->
  <!-- ---------------------------------------------------------------------------------------------------------- -->


  <!-- Bootstrap JS -->
  
  <script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.0.2/js/bootstrap.bundle.min.js"></script>
</body>
<footer class="footer mt-5 text-center">

  <p>&copy; 2023 JW / Incredible / LogistixAI. Only for Internal use. All rights reserved</p>
 
</footer>
</html>
